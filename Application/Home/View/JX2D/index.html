<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>简衣制造</title>
    <link rel="stylesheet" href="__STATIC__/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="__JXRESOURCE__/basic/css/jx{$Think.config.DOT_MIN}.css">
    <link rel="stylesheet" href="__JXRESOURCE__/2d/css/jx2d{$Think.config.DOT_MIN}.css">
    <script src="__STATIC__/sea-2.3.0.min.js"></script>
    <script src="__STATIC__/jquery-2.1.4.min.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrap.min.js"></script>
    <script src="__STATIC__/nstSlider/js/jquery.nstSlider.min.js"></script>
    <script src="__STATIC__/three.js"></script>
    <script src="__STATIC__/three.jx.js"></script>
</head>
<body>
<div class="container-fiuld">
    <div class="jx2d-container">
        <div class="control-left">
            <div class="viewport-group">
                <canvas class="viewport-2d" id="viewport-2d" width="500" height="500" style="width: 500px; height: 500px; background: url(__JXRESOURCE__/2d/imgs/pictrues/t-shirt_2_wht.jpg);background-position:center;background-size: contain"></canvas>
            </div>
            <div class="row jxrow-padding-5">
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
                <div class="col-sm-2">
                    <div class="project-template-group"></div>
                </div>
            </div>
            <div class="spot-place"></div>
        </div>

        <div class="control-right">
            <h3>标题位置: XXXX</h3>
            <h5>￥59.9</h5>
            <button class="btn btn-default btn-block" type="button" data-toggle="modal" data-target="#jx2d-product-modal">选择产品</button> 
            <!-- jx2d product modal -->
            <div id="jx2d-product-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="jx2d-product-modal-label">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <!-- <h4 class="modal-title" id="jx2d-product-modal-label">请选择产品</h4> -->
                        <ul class="nav nav-pills">
                            <li role="presentation" class="jx2d-product-label" pid="jx2d-product-tshirt"><a href="javascript:void(0)">T恤</a></li>
                            <li role="presentation" class="jx2d-product-label" pid="jx2d-product-longsleeve"><a href="javascript:void(0)">长袖</a></li>
                            <li role="presentation" class="jx2d-product-label" pid="jx2d-product-tanktop"><a href="javascript:void(0)">背心</a></li>
                        </ul>
                    </div>
                    <div class="modal-body">
                        <div class="jx2d-product-item-group">
                            <div class="row" id="jx2d-product-tshirt" style="display: none">
                                <foreach name="jx_2d_out.products.tshirts" item="jx_tshirt" key="jx_2d_pn">
                                <div class="col-sm-3">
                                    <div class="jx2d-product-item">
                                        <img class="jx2d-product-item-img" src="{$jx_tshirt.0.path}" alt="">
                                        <span class="jx2d-product-item-label">{$jx_2d_pn}</span>
                                    </div>
                                </div>
                                </foreach>
                            </div>
                            <div class="row" id="jx2d-product-longsleeve" style="display: none">
                                <foreach name="jx_2d_out.products.longsleeve" item="jx_longsleeve" key="jx_2d_pn">
                                    <div class="col-sm-3">
                                        <div class="jx2d-product-item">
                                            <img class="jx2d-product-item-img" src="{$jx_longsleeve.0.path}" alt="">
                                            <span class="jx2d-product-item-label">{$jx_2d_pn}</span>
                                        </div>
                                    </div>
                                </foreach>
                            </div>
                            <div class="row" id="jx2d-product-tanktop" style="display: none">
                                <foreach name="jx_2d_out.products.tanktops" item="jx_tanktop" key="jx_2d_pn">
                                    <div class="col-sm-3">
                                        <div class="jx2d-product-item">
                                            <img class="jx2d-product-item-img" src="{$jx_tanktop.0.path}" alt="">
                                            <span class="jx2d-product-item-label">{$jx_2d_pn}</span>
                                        </div>
                                    </div>
                                </foreach>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-default">确定</button>
                    </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <!-- size panel -->
                    <div class="jx2d-font-select">
                        <span>数量</span>
                        <div class="input-group input-group-sm">
                            <span class="input-group-btn">
                                <button class="btn btn-default">
                                    <span class="glyphicon glyphicon-minus"></span>
                                </button>
                            </span>
                            <input type="text" class="form-control" placeholder="The is number" value="1" pattern="[0-9]">
                            <span class="input-group-btn">
                                <button class="btn btn-default">
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <!-- color panel -->
                    <div class="jx2d-color-select">
                        <span>颜色</span>
                        <icon class="jx2d-cs-item" cid="jx2d-style-color-g"></icon>
                    </div>
                </div>
            </div>

            <!-- jx2d style color panel -->
            <div class="jx2d-properties-style-color jx-panel jx-panel-tri">
                <div class="jx-panel-title">
                    <span class="label">颜色选择</span>
                    <span class="close glyphicon glyphicon-remove-circle"></span>
                </div>
                <!-- jx2d color group -->
                <div class="jx2d-color-group">
                    <div class="row jxrow-padding-2">
                        <foreach name="jx_2d_out.text_colors" item="jx_color" key="k">
                            <div class="col-sm-1">
                                <a href="#" class="jx2d-color-box">
                                    <span style="background-color: #{$jx_color.color};"></span>
                                </a>
                            </div>
                        </foreach>
                    </div>
                </div>
            </div>

            <div class="jx2d-photo-text-group">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="dropdown">
                            <button class="btn btn-default btn-block dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                创建图片
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                <li><a href="#">上传</a></li>
                                <li><a href="#">剪贴画</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <button class="btn btn-default btn-block" id="jx2d-create-text">创建文字</button>
                    </div>
                </div>
            </div>
            <div class="panel-group" id="jx2d-properites-pg" role="tablist" aria-multiselectable="true">
                <!-- jx2d panel common -->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="jx2d-common-phear">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#jx2d-properites-pg" href="#jx2d-common-pbody" aria-expanded="true" aria-controls="jx2d-common-pbody">
                                一般属性
                            </a>
                        </h4>
                    </div>
                    <div id="jx2d-common-pbody" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="jx2d-common-phear">
                        <div class="panel-body">
                            <div class="jx2d-properties-panel">
                                <!--position-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel-2">位置</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="pos_x" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="-360" data-range_max="360" data-cur_min="80" typename="pos_x"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>


                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="pos_y" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="-360" data-range_max="360" data-cur_min="80" typename="pos_y"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--rotation-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel">旋转</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="rotation" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="-360" data-range_max="360" data-cur_min="80" typename="rotation"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--scale-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel">缩放</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="scale" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="1" data-range_max="1000" data-cur_min="100" typename="scale"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- jx2d panel text -->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="jx2d-text-phear">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#jx2d-properites-pg" href="#jx2d-text-pbody" aria-expanded="true" aria-controls="jx2d-text-pbody">
                                文字属性
                            </a>
                        </h4>
                    </div>
                    <div id="jx2d-text-pbody" class="panel-collapse collapse" role="tabpanel" aria-labelledby="jx2d-text-phear">
                        <div class="panel-body">
                            <!--text content-->
                            <div class="jx2d-content-select">
                                <span>内容</span>
                                <input type="text" class="form-control" id="jx2d-text-content" placeholder="Content">
                            </div>
                            <div class="jx2d-properties-text">
                                <!--font, color, strokeColor, shadowColor-->
                                <div class="row jxrow-padding-0">
                                    <div class="col-sm-3">
                                        <div class="jx2d-font-select">
                                            <span>字体</span>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-default">Action</button>
                                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="caret"></span>
                                                    <span class="sr-only">Toggle Dropdown</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="#">Action</a></li>
                                                    <li><a href="#">Another action</a></li>
                                                    <li><a href="#">Something else here</a></li>
                                                    <li role="separator" class="divider"></li>
                                                    <li><a href="#">Separated link</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="jx2d-color-select">
                                            <span>颜色</span>
                                            <icon class="jx2d-cs-item" cid="jx2d-text-color-g"></icon>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="jx2d-color-select">
                                            <span>描边</span>
                                            <icon class="jx2d-cs-item" cid="jx2d-text-stroke-g"></icon>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="jx2d-color-select">
                                            <span>阴影</span>
                                            <icon class="jx2d-cs-item" cid="jx2d-text-shadow-g"></icon>
                                        </div>
                                    </div>
                                </div>

                                <!-- jx2d text color panel -->
                                <div class="jx2d-properties-text-color jx-panel jx-panel-tri">
                                    <div class="jx-panel-title">
                                        <span class="label">文字颜色控制</span>
                                        <span class="close glyphicon glyphicon-remove-circle"></span>
                                    </div>
                                    <!-- jx2d color group -->
                                    <div class="jx2d-color-group">
                                        <div class="row jxrow-padding-2">
                                            <foreach name="jx_2d_out.text_colors" item="jx_color" key="k">
                                                <div class="col-sm-1">
                                                    <a href="#" class="jx2d-color-box">
                                                        <span style="background-color: #{$jx_color.color};"></span>
                                                    </a>
                                                </div>
                                            </foreach>
                                        </div>
                                    </div>
                                </div>

                                <!-- jx2d text stroke panel -->
                                <div class="jx2d-properties-text-stroke jx-panel jx-panel-tri">
                                    <div class="jx-panel-title">
                                        <span class="label">文字描边属性控制</span>
                                        <span class="close glyphicon glyphicon-remove-circle"></span>
                                    </div>
                                    <!-- jx2d color group -->
                                    <div class="jx2d-color-group">
                                        <div class="row jxrow-padding-2">
                                            <foreach name="jx_2d_out.text_colors" item="jx_color" key="k">
                                                <div class="col-sm-1">
                                                    <a href="#" class="jx2d-color-box">
                                                        <span style="background-color: #{$jx_color.color};"></span>
                                                    </a>
                                                </div>
                                            </foreach>
                                        </div>
                                    </div>
                                    <!--text stroke size-->
                                    <div class="row jxrow-padding-2">
                                        <div class="col-sm-2">
                                            <span class="jxnstLabel">大小</span>
                                        </div>
                                        <div class="col-sm-10">
                                            <div class="jxntSlider-group">
                                                <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_stroke_size" style="ime-mode:disabled"></div>
                                                <div class="jxnstSlider-g">
                                                    <div class="jxnstSlider" data-range_min="0" data-range_max="360" data-cur_min="80" typename="text_stroke_size"><div class="leftGrip"></div></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- jx2d text shadow panel -->
                                <div class="jx2d-properties-text-shadow jx-panel jx-panel-tri">
                                    <div class="jx-panel-title">
                                        <span class="label">文字阴影属性控制</span>
                                        <span class="close glyphicon glyphicon-remove-circle"></span>
                                    </div>
                                    <!-- jx2d color group -->
                                    <div class="jx2d-color-group">
                                        <div class="row jxrow-padding-2">
                                            <foreach name="jx_2d_out.text_colors" item="jx_color" key="k">
                                                <div class="col-sm-1">
                                                    <a href="#" class="jx2d-color-box">
                                                        <span style="background-color: #{$jx_color.color};"></span>
                                                    </a>
                                                </div>
                                            </foreach>
                                        </div>
                                    </div>

                                    <!--text shaow distance-->
                                    <div class="row jxrow-padding-2">
                                        <div class="col-sm-2">
                                            <span class="jxnstLabel">偏移</span>
                                        </div>
                                        <div class="col-sm-10">
                                            <div class="jxntSlider-group">
                                                <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_shadow_distance" style="ime-mode:disabled"></div>
                                                <div class="jxnstSlider-g">
                                                    <div class="jxnstSlider" data-range_min="0" data-range_max="360" data-cur_min="80" typename="text_shadow_distance"><div class="leftGrip"></div></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--text shaow angle-->
                                    <div class="row jxrow-padding-2">
                                        <div class="col-sm-2">
                                            <span class="jxnstLabel">角度</span>
                                        </div>
                                        <div class="col-sm-10">
                                            <div class="jxntSlider-group">
                                                <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_shadow_angle" style="ime-mode:disabled"></div>
                                                <div class="jxnstSlider-g">
                                                    <div class="jxnstSlider" data-range_min="0" data-range_max="360" data-cur_min="80" typename="text_shadow_angle"><div class="leftGrip"></div></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--text size-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel">大小</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_size" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="0" data-range_max="360" data-cur_min="80" typename="text_size"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--text space-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel">间距</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_space" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="0" data-range_max="1000" data-cur_min="300" typename="text_space"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--text arc-->
                                <div class="row jxrow-padding-2">
                                    <div class="col-sm-2">
                                        <span class="jxnstLabel">弧度</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="jxntSlider-group">
                                            <div class="jxnstInput-g"><input type="text" class="jxNumber form-control jx2d-input" typename="text_arc" style="ime-mode:disabled"></div>
                                            <div class="jxnstSlider-g">
                                                <div class="jxnstSlider" data-range_min="-36000" data-range_max="36000" data-cur_min="1" typename="text_arc"><div class="leftGrip"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- jx2d panel photo -->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="jx2d-photo-phear">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#jx2d-properites-pg" href="#jx2d-photo-pbody" aria-expanded="true" aria-controls="jx2d-photo-pbody">
                                图片属性
                            </a>
                        </h4>
                    </div>
                    <div id="jx2d-photo-pbody" class="panel-collapse collapse" role="tabpanel" aria-labelledby="jx2d-photo-phear">
                        <div class="panel-body">
                            <!-- jx2d propertier photo -->
                            <div class="jx2d-properties-photo">
                                <div class='row jxrow-padding-5'>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                    <div class='col-sm-2'>
                                        <div class='jx2d-filter-group'></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script>
(function() {
    var slider_ms = 100;

    var canvas = document.getElementById("viewport-2d");
    var width = canvas.clientWidth, height = canvas.clientHeight, halfWidth = width/2, halfHeight = height/2;

    var maskHalfWith = 120, maskHalfHeight = 150;
    var mask = new THREE.JX.JXPolygonMask([
        new THREE.Vector2(-maskHalfWith, maskHalfHeight),
        new THREE.Vector2(maskHalfWith, maskHalfHeight),
        new THREE.Vector2(maskHalfWith, -maskHalfHeight),
        new THREE.Vector2(-maskHalfWith, -maskHalfHeight)
    ]);

    mask.strokeColor.setRGB(0.2, 0.3, 0.9);

    var shapeGroup = new THREE.Group();

    var viewport2d = new Viewport2D(canvas, shapeGroup, mask);

    // init modal
    $("jx2d-product-modal").modal({

    });

    // set canvas height
    // var jquery_viewport = $(".viewport-2d");
    // jquery_viewport.css({height: jquery_viewport.css("width")});

    var jquery_project_tmp = $(".project-template-group");
    jquery_project_tmp.css({height: jquery_project_tmp.css("width")});

    // $(window).on("resize", function() {
    //     jquery_viewport.css({height: jquery_viewport.css("width")});
    //     jquery_project_tmp.css({height: jquery_project_tmp.css("width")});
    // });

    $('.jxnstSlider').nstSlider({
        "left_grip_selector": ".leftGrip",
        "value_changed_callback": function(cause, leftValue, rightValue) {
//            $(this).parent().find('.leftLabel').text(leftValue);

            var val_left = (parseFloat(leftValue) / slider_ms).toFixed(2);
            $(this).parent().parent().find(".jxnstInput-g").children().val(val_left);
            var type_name = $(this).attr("typename");

            $('.jx2d-input[typename=' + type_name + ']').change();
        }
    });

    // set slider element value
    var setSliderValue = function(jqe, value) {
        var _mmin = jqe.nstSlider('get_range_min');
        var _mmax = jqe.nstSlider('get_range_max');
        if(value < _mmin) value = _mmin;
        else if(value > _mmax) value = _mmax;

        jqe.nstSlider('set_position', value);
    };

    $('.jx2d-input').on('change', function() {
        var _value = $(this).val();
        var type_name = $(this).attr("typename");


//        var _min = $('.jxnstSlider[typename=' + type_name + ']').nstSlider("get_range_min");
//
//        var _max = $('.jxnstSlider[typename=' + type_name + ']').nstSlider("get_range_max");
//
//        var value_ = _value * slider_ms;
//
//        if(value_ < _min) value_ = _min;
//        else if(value_ > _max) value_ = _max;
//
//        $('.jxnstSlider[typename=' + type_name + ']').nstSlider("set_position", value_);

        setSliderValue($('.jxnstSlider[typename=' + type_name + ']'), _value * slider_ms);

        switch(type_name) {
            case "pos_x":
                if(viewport2d.current_object) viewport2d.current_object.position.x = parseFloat(_value);
                break;
            case "pos_y":
                if(viewport2d.current_object) viewport2d.current_object.position.y = parseFloat(_value);
                break;
            case "rotation":
                if(viewport2d.current_object) viewport2d.current_object.rotation.z = parseInt(_value)/Math.PI;
                break;
            case "scale":
                if(viewport2d.current_object) {
                    viewport2d.current_object.scale.x = parseFloat(_value);
                    viewport2d.current_object.scale.y = parseFloat(_value);
                }
                break;
            case "text_size":
                if(viewport2d.current_object && viewport2d.current_object.type == "JXText") {
                    viewport2d.current_object.size = parseFloat(_value);
                }
                break;
            case "text_space":
                if(viewport2d.current_object && viewport2d.current_object.type == "JXText") {
                    viewport2d.current_object.space = parseFloat(_value);
                }
                break;
            case "text_arc":
                if(viewport2d.current_object && viewport2d.current_object.type == "JXText") {
                    viewport2d.current_object.arc = parseInt(_value) / 180 * Math.PI;
                }
                break;
        }

        viewport2d.update();
    });



    $(".jxNumber").on("input", function() {

        var val = $(this).val().replace(/[^0-9\.\-]/,'');

        // remove - (ex before)
        var _val = val.replace(/\-/g, '');
        if(val[0] === "-") {
            _val = "-" + _val;
        }

        // remove - (only one)
        var _vals = [];
        var isDot = false;
        for(var i=0; i<_val.length; i++) {
            if(_val[i] === ".") {
                if(!isDot) {
                    _vals.push(_val[i]);
                    isDot = true;
                }
            } else {
                _vals.push(_val[i]);
            }
        }

        $(this).val(_vals.join(''));
    });

    var current_color_item_jqe = null;
    $(".jx2d-cs-item").each(function() {
        $(this).on('click', function(event) {
            event.stopPropagation();
            var cid = $(this).attr("cid");
            $(".jx2d-properties-style-color, .jx2d-properties-text-color, .jx2d-properties-text-stroke, .jx2d-properties-text-shadow").hide();
            switch(cid) {
                case "jx2d-style-color-g":
                    $(".jx2d-properties-style-color").show();
                    break;
                case "jx2d-text-color-g":
                    $(".jx2d-properties-text-color").show();
                    break;
                case "jx2d-text-stroke-g":
                    $(".jx2d-properties-text-stroke").show();
                    break;
                case "jx2d-text-shadow-g":
                    $(".jx2d-properties-text-shadow").show();
                    break;
            }

            current_color_item_jqe = $(this);
        });
    });

    // $("body").on("click", function() {
    //     $(".jx-panel").hide();
    // });

    // select color box
    var current_color_jquery_element = null;
    $(".jx2d-color-box").each(function() {
        $(this).on('click', function(event) {
            event.stopPropagation();
            if(current_color_jquery_element) {
                current_color_jquery_element.removeClass('active');
            }
            $(this).addClass('active');
            current_color_jquery_element = $(this);

            if(current_color_item_jqe) {
                current_color_item_jqe.css({backgroundColor: $(this).children("span").css("backgroundColor")});
            }
        });
    });

    $(".jx-panel .jx-panel-title .close").on("click", function() {
        $(this).parent().parent().hide();
    });

    var current_product_label, i=0;
    $(".jx2d-product-label").each(function() {
        if(i == 0) {
            current_product_label = $(this);
            if(!current_product_label.hasClass("active")) {
                current_product_label.addClass("active");
            }
            $("#" + current_product_label.attr("pid")).show();
        }
        $(this).on("click", function() {
            if(current_product_label && current_product_label.hasClass("active")) {
                current_product_label.removeClass("active");
            }

            if(current_product_label) $("#" + current_product_label.attr("pid")).hide();

            current_product_label = $(this);

            $("#" + current_product_label.attr("pid")).show();

            if(!current_product_label.hasClass("active")) {
                current_product_label.addClass("active");
            }
        });
        i++;
    });




    $("#jx2d-create-text").on('click', function() {
        var text = new THREE.JX.JXText();
        text.content = "www.janexi.com";
        text.color.setRGB(0.5, 0, 0.5);
        text.size = 10;
        shapeGroup.add(text);
        viewport2d.update();
    });

    var setInputValue = function (jqe, value) {
        jqe.val(value);
        jqe.change();
    };

    var updateTransformPanel = function(object) {
        setInputValue($('.jx2d-input[typename=pos_x]'), object.position.x);
        setInputValue($('.jx2d-input[typename=pos_y]'), object.position.y);
        setInputValue($('.jx2d-input[typename=rotation]'), object.rotation.z);
        setInputValue($('.jx2d-input[typename=scale]'), object.scale.x);
    };

    var updateTextPanel = function(object) {
        $("#jx2d-text-content").val(object.content);
        setInputValue($('.jx2d-input[typename=text_size]'), object.size);
        setInputValue($('.jx2d-input[typename=text_space]'), object.space);
        setInputValue($('.jx2d-input[typename=text_arc]'), object.arc);
    };

    viewport2d.onIntersect = function(object) {
        updateTransformPanel(object);
        if(object.type == "JXText") {
            updateTextPanel(object);
        }
    };

})();
</script>
</body>

</html>